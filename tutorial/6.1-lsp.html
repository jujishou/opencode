<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="OpenCode LSP语言服务器配置 - 内置语言智能支持">
  <title>6.1 LSP语言服务器 - OpenCode深度教程</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⚡</text></svg>">
</head>
<body>
  <nav class="navbar"><button class="mobile-menu-btn" aria-label="菜单"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button><a href="../index.html" class="navbar-brand"><div class="logo">OC</div><span>OpenCode深度教程</span></a><div class="navbar-nav"><a href="../index.html">首页</a><a href="1.1-what-is-opencode.html">教程</a><a href="../community.html">社群</a><a href="https://opencode.ai/docs" target="_blank">官方文档</a><a href="https://github.com/anomalyco/opencode" target="_blank">GitHub</a></div><div class="navbar-right"><div class="search-box"><svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg><input type="text" class="search-input" placeholder="搜索教程..."><div class="search-results"></div></div><button class="theme-toggle" aria-label="切换主题"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></button></div></nav>
  <aside class="sidebar"><div class="sidebar-content"><div class="sidebar-section"><div class="sidebar-title">第一章：入门指南</div><ul class="sidebar-nav"><li><a href="1.1-what-is-opencode.html"><span class="chapter-number">1.1</span>什么是OpenCode</a></li><li><a href="1.2-installation.html"><span class="chapter-number">1.2</span>安装OpenCode</a></li><li><a href="1.3-quickstart.html"><span class="chapter-number">1.3</span>快速开始</a></li><li><a href="1.4-terminal-requirements.html"><span class="chapter-number">1.4</span>终端要求</a></li></ul></div><div class="sidebar-section"><div class="sidebar-title">第二章：基础配置</div><ul class="sidebar-nav"><li><a href="2.1-config-file.html"><span class="chapter-number">2.1</span>配置文件详解</a></li><li><a href="2.2-providers.html"><span class="chapter-number">2.2</span>AI提供商配置</a></li><li><a href="2.3-models.html"><span class="chapter-number">2.3</span>模型选择与配置</a></li><li><a href="2.4-environment.html"><span class="chapter-number">2.4</span>环境变量设置</a></li></ul></div><div class="sidebar-section"><div class="sidebar-title">第三章：界面操作</div><ul class="sidebar-nav"><li><a href="3.1-tui.html"><span class="chapter-number">3.1</span>TUI终端界面</a></li><li><a href="3.2-cli.html"><span class="chapter-number">3.2</span>CLI命令行接口</a></li><li><a href="3.3-web.html"><span class="chapter-number">3.3</span>Web界面</a></li><li><a href="3.4-ide.html"><span class="chapter-number">3.4</span>IDE集成</a></li></ul></div><div class="sidebar-section"><div class="sidebar-title">第四章：核心功能</div><ul class="sidebar-nav"><li><a href="4.1-tools.html"><span class="chapter-number">4.1</span>内置工具详解</a></li><li><a href="4.2-commands.html"><span class="chapter-number">4.2</span>斜杠命令</a></li><li><a href="4.3-keybinds.html"><span class="chapter-number">4.3</span>快捷键参考</a></li><li><a href="4.4-file-reference.html"><span class="chapter-number">4.4</span>文件引用与搜索</a></li></ul></div><div class="sidebar-section"><div class="sidebar-title">第五章：高级配置</div><ul class="sidebar-nav"><li><a href="5.1-agents.html"><span class="chapter-number">5.1</span>Agents代理系统</a></li><li><a href="5.2-rules.html"><span class="chapter-number">5.2</span>Rules规则配置</a></li><li><a href="5.3-themes.html"><span class="chapter-number">5.3</span>主题配置</a></li><li><a href="5.4-permissions.html"><span class="chapter-number">5.4</span>权限系统</a></li></ul></div><div class="sidebar-section"><div class="sidebar-title">第六章：扩展功能</div><ul class="sidebar-nav"><li><a href="6.1-lsp.html" class="active"><span class="chapter-number">6.1</span>LSP语言服务器</a></li><li><a href="6.2-formatters.html"><span class="chapter-number">6.2</span>代码格式化器</a></li><li><a href="6.3-custom-commands.html"><span class="chapter-number">6.3</span>自定义命令</a></li><li><a href="6.4-mcp.html"><span class="chapter-number">6.4</span>MCP协议服务器</a></li></ul></div><div class="sidebar-section"><div class="sidebar-title">第七章：开发与集成</div><ul class="sidebar-nav"><li><a href="7.1-sdk.html"><span class="chapter-number">7.1</span>SDK使用指南</a></li><li><a href="7.2-network.html"><span class="chapter-number">7.2</span>网络配置</a></li><li><a href="7.3-enterprise.html"><span class="chapter-number">7.3</span>企业版功能</a></li><li><a href="7.4-troubleshooting.html"><span class="chapter-number">7.4</span>故障排除</a></li></ul></div></div></aside>
  <main class="main-content">
    <nav class="breadcrumb"><a href="../index.html">首页</a><span class="breadcrumb-separator">/</span><a href="6.1-lsp.html">第六章</a><span class="breadcrumb-separator">/</span><span>LSP语言服务器</span></nav>
    <article>
      <header class="article-header"><h1 class="article-title">6.1 LSP语言服务器</h1><div class="article-meta"><span class="tag">扩展功能</span><span>第六章：扩展功能</span></div></header>
      <div class="article-content">
        <p>OpenCode内置了强大的LSP（Language Server Protocol）支持，为AI提供深度代码理解能力，包括代码补全、跳转定义、查找引用等功能。</p>

        <h2>什么是LSP</h2>
        <p>LSP（Language Server Protocol，语言服务器协议）是微软开发的一种开放协议，用于在代码编辑器和语言服务器之间进行通信。它提供了：</p>
        <ul>
          <li><strong>代码智能</strong> - 自动补全、语法高亮、错误诊断</li>
          <li><strong>代码导航</strong> - 跳转到定义、查找引用、符号搜索</li>
          <li><strong>代码重构</strong> - 重命名、提取函数、代码操作</li>
          <li><strong>悬停信息</strong> - 显示类型信息、文档注释</li>
        </ul>

        <p>OpenCode通过集成LSP，让AI能够更准确地理解代码结构和语义关系。</p>

        <h2>内置支持的语言</h2>
        <p>OpenCode内置支持25+种编程语言的LSP服务器，会根据项目文件自动检测并安装：</p>

        <table>
          <thead><tr><th>语言</th><th>LSP服务器</th><th>文件扩展名</th></tr></thead>
          <tbody>
            <tr><td>TypeScript/JavaScript</td><td>typescript-language-server</td><td>.ts, .tsx, .js, .jsx</td></tr>
            <tr><td>Python</td><td>pyright</td><td>.py</td></tr>
            <tr><td>Go</td><td>gopls</td><td>.go</td></tr>
            <tr><td>Rust</td><td>rust-analyzer</td><td>.rs</td></tr>
            <tr><td>C/C++</td><td>clangd</td><td>.c, .cpp, .h</td></tr>
            <tr><td>Java</td><td>jdtls</td><td>.java</td></tr>
            <tr><td>C#</td><td>omnisharp</td><td>.cs</td></tr>
            <tr><td>PHP</td><td>intelephense</td><td>.php</td></tr>
            <tr><td>Ruby</td><td>solargraph</td><td>.rb</td></tr>
            <tr><td>Swift</td><td>sourcekit-lsp</td><td>.swift</td></tr>
            <tr><td>Kotlin</td><td>kotlin-language-server</td><td>.kt</td></tr>
            <tr><td>Lua</td><td>lua-language-server</td><td>.lua</td></tr>
            <tr><td>Zig</td><td>zls</td><td>.zig</td></tr>
            <tr><td>HTML</td><td>vscode-html-language-server</td><td>.html</td></tr>
            <tr><td>CSS</td><td>vscode-css-language-server</td><td>.css, .scss, .less</td></tr>
            <tr><td>JSON</td><td>vscode-json-language-server</td><td>.json</td></tr>
            <tr><td>YAML</td><td>yaml-language-server</td><td>.yaml, .yml</td></tr>
            <tr><td>Markdown</td><td>marksman</td><td>.md</td></tr>
            <tr><td>SQL</td><td>sql-language-server</td><td>.sql</td></tr>
            <tr><td>Bash</td><td>bash-language-server</td><td>.sh, .bash</td></tr>
            <tr><td>Dockerfile</td><td>dockerfile-language-server</td><td>Dockerfile</td></tr>
            <tr><td>Terraform</td><td>terraform-ls</td><td>.tf</td></tr>
            <tr><td>Elixir</td><td>elixir-ls</td><td>.ex, .exs</td></tr>
            <tr><td>Haskell</td><td>haskell-language-server</td><td>.hs</td></tr>
            <tr><td>OCaml</td><td>ocamllsp</td><td>.ml</td></tr>
          </tbody>
        </table>

        <h2>自动安装功能</h2>
        <p>OpenCode会自动检测项目使用的语言，并在需要时自动安装对应的LSP服务器：</p>
        <pre><code># 当你打开一个TypeScript项目时
opencode

# OpenCode会自动：
# 1. 检测到 .ts 文件
# 2. 检查是否已安装 typescript-language-server
# 3. 如未安装，自动通过npm安装
# 4. 启动LSP服务器并连接</code></pre>

        <div class="tip-box info">
          <div class="tip-box-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>提示</div>
          <div class="tip-box-content">自动安装需要相应的包管理器（如npm、pip、cargo等）已在系统中安装。</div>
        </div>

        <h2>配置选项</h2>
        <p>可以在配置文件中自定义LSP行为：</p>

        <h3>基本配置结构</h3>
        <pre><code>{
  "lsp": {
    "typescript": {
      "disabled": false,
      "command": ["typescript-language-server", "--stdio"],
      "extensions": [".ts", ".tsx", ".js", ".jsx"],
      "env": {
        "TSC_NONPOLLING_WATCHER": "true"
      },
      "initialization": {
        "preferences": {
          "includeInlayParameterNameHints": "all"
        }
      }
    }
  }
}</code></pre>

        <h3>配置项说明</h3>
        <table>
          <thead><tr><th>配置项</th><th>类型</th><th>说明</th></tr></thead>
          <tbody>
            <tr><td><code>disabled</code></td><td>boolean</td><td>是否禁用此语言的LSP</td></tr>
            <tr><td><code>command</code></td><td>string[]</td><td>启动LSP服务器的命令和参数</td></tr>
            <tr><td><code>extensions</code></td><td>string[]</td><td>关联的文件扩展名</td></tr>
            <tr><td><code>env</code></td><td>object</td><td>LSP服务器的环境变量</td></tr>
            <tr><td><code>initialization</code></td><td>object</td><td>LSP初始化选项</td></tr>
          </tbody>
        </table>

        <h3>环境变量配置</h3>
        <pre><code>{
  "lsp": {
    "python": {
      "env": {
        "PYTHONPATH": "/path/to/custom/modules",
        "VIRTUAL_ENV": "/path/to/venv"
      }
    }
  }
}</code></pre>

        <h3>初始化选项</h3>
        <pre><code>{
  "lsp": {
    "rust": {
      "initialization": {
        "cargo": {
          "buildScripts": {
            "enable": true
          }
        },
        "procMacro": {
          "enable": true
        }
      }
    }
  }
}</code></pre>

        <h2>禁用LSP</h2>

        <h3>禁用特定语言的LSP</h3>
        <pre><code>{
  "lsp": {
    "javascript": {
      "disabled": true
    }
  }
}</code></pre>

        <h3>完全禁用LSP功能</h3>
        <pre><code>{
  "lsp": {
    "*": {
      "disabled": true
    }
  }
}</code></pre>

        <h3>通过环境变量禁用</h3>
        <pre><code># 禁用所有LSP
export OPENCODE_LSP_DISABLED=true

# 禁用自动安装
export OPENCODE_LSP_AUTO_INSTALL=false</code></pre>

        <h2>自定义LSP服务器</h2>
        <p>可以添加OpenCode未内置支持的语言服务器：</p>

        <h3>添加新语言支持</h3>
        <pre><code>{
  "lsp": {
    "custom-lang": {
      "command": ["custom-language-server", "--stdio"],
      "extensions": [".custom", ".cust"],
      "env": {},
      "initialization": {}
    }
  }
}</code></pre>

        <h3>使用Docker运行LSP</h3>
        <pre><code>{
  "lsp": {
    "java": {
      "command": [
        "docker", "run", "--rm", "-i",
        "-v", "${workspaceFolder}:/workspace",
        "jdtls-image"
      ]
    }
  }
}</code></pre>

        <h3>使用远程LSP服务器</h3>
        <pre><code>{
  "lsp": {
    "typescript": {
      "command": ["nc", "localhost", "2089"]
    }
  }
}</code></pre>

        <h2>LSP工具使用</h2>
        <p>OpenCode提供了<code>lsp</code>工具，AI可以通过它获取代码智能信息：</p>
        <pre><code># AI可能会这样使用LSP工具：
# - 获取函数定义
# - 查找所有引用
# - 获取类型信息
# - 诊断代码问题</code></pre>

        <div class="tip-box warning">
          <div class="tip-box-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>注意</div>
          <div class="tip-box-content">LSP功能目前是实验性的，某些语言的支持可能不完整。</div>
        </div>

        <h2>故障排除</h2>

        <h3>LSP服务器无法启动</h3>
        <ul>
          <li>检查是否已安装对应的语言服务器</li>
          <li>确认command路径是否正确</li>
          <li>查看OpenCode日志获取详细错误信息</li>
        </ul>

        <h3>代码智能不工作</h3>
        <ul>
          <li>确认项目有正确的配置文件（如tsconfig.json）</li>
          <li>检查文件扩展名是否在extensions列表中</li>
          <li>尝试重启OpenCode</li>
        </ul>

        <h2>下一步</h2>
        <p>接下来学习如何配置代码格式化器，保持代码风格一致性。</p>
      </div>
      <nav class="article-nav">
        <a href="5.4-permissions.html" class="article-nav-item prev"><div class="article-nav-label">← 上一篇</div><div class="article-nav-title">5.4 权限系统</div></a>
        <a href="6.2-formatters.html" class="article-nav-item next"><div class="article-nav-label">下一篇 →</div><div class="article-nav-title">6.2 代码格式化器</div></a>
      </nav>
    </article>
  </main>
  <nav class="toc"><div class="toc-title">本页目录</div><ul class="toc-list"></ul></nav>
  <button class="back-to-top" aria-label="回到顶部"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="18 15 12 9 6 15"></polyline></svg></button>
  <script src="../js/main.js"></script>
</body>
</html>
