<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="OpenCode常见问题和故障排除指南，解决使用中的问题。">
  <meta name="keywords" content="OpenCode故障排除, 常见问题, 问题解决">
  <meta name="robots" content="index, follow">
  <title>7.4 故障排除 - OpenCode深度教程</title>
  <link rel="stylesheet" href="../css/style.css">
  
  <!-- Canonical URL -->
  <link rel="canonical" href="https://opencode.aialiang.com/tutorial/7.4-troubleshooting.html">

  <!-- Open Graph Meta Tags -->
  <meta property="og:type" content="article">
  <meta property="og:url" content="https://opencode.aialiang.com/tutorial/7.4-troubleshooting.html">
  <meta property="og:title" content="故障排除 - OpenCode深度教程">
  <meta property="og:description" content="OpenCode常见问题和故障排除指南，解决使用中的问题。">
  <meta property="og:image" content="https://opencode.aialiang.com/images/og-image.png">
  <meta property="og:site_name" content="OpenCode深度教程">
  <meta property="og:locale" content="zh_CN">
  <meta property="article:section" content="第七章：开发与集成">

  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="故障排除 - OpenCode深度教程">
  <meta name="twitter:description" content="OpenCode常见问题和故障排除指南，解决使用中的问题。">
  <meta name="twitter:image" content="https://opencode.aialiang.com/images/og-image.png">

  <!-- JSON-LD Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": "故障排除",
    "description": "OpenCode常见问题和故障排除指南，解决使用中的问题。",
    "url": "https://opencode.aialiang.com/tutorial/7.4-troubleshooting.html",
    "inLanguage": "zh-CN",
    "isPartOf": {
      "@type": "WebSite",
      "name": "OpenCode深度教程",
      "url": "https://opencode.aialiang.com/"
    },
    "publisher": {
      "@type": "Organization",
      "name": "OpenCode深度教程",
      "url": "https://opencode.aialiang.com/"
    },
    "articleSection": "第七章：开发与集成"
  }
  </script>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": [
      {"@type": "ListItem", "position": 1, "name": "首页", "item": "https://opencode.aialiang.com/"},
      {"@type": "ListItem", "position": 2, "name": "第七章：开发与集成", "item": "https://opencode.aialiang.com/tutorial/7.4.1-sdk.html"},
      {"@type": "ListItem", "position": 3, "name": "故障排除", "item": "https://opencode.aialiang.com/tutorial/7.4-troubleshooting.html"}
    ]
  }
  </script>

  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>⚡</text></svg>">
</head>
<body>
  <nav class="navbar"><button class="mobile-menu-btn" aria-label="菜单"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button><a href="../index.html" class="navbar-brand"><div class="logo">OC</div><span>OpenCode深度教程</span></a><div class="navbar-nav"><a href="../index.html">首页</a><a href="1.1-what-is-opencode.html">教程</a><a href="../community.html">社群</a><a href="https://opencode.ai/docs" target="_blank">官方文档</a><a href="https://github.com/anomalyco/opencode" target="_blank">GitHub</a></div><div class="navbar-right"><div class="search-box"><svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg><input type="text" class="search-input" placeholder="搜索教程..."><div class="search-results"></div></div><button class="theme-toggle" aria-label="切换主题"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg></button></div></nav>
  <aside class="sidebar"><div class="sidebar-content"><div class="sidebar-section"><div class="sidebar-title">第一章：入门指南</div><ul class="sidebar-nav"><li><a href="1.1-what-is-opencode.html"><span class="chapter-number">1.1</span>什么是OpenCode</a></li><li><a href="1.2-installation.html"><span class="chapter-number">1.2</span>安装OpenCode</a></li><li><a href="1.3-quickstart.html"><span class="chapter-number">1.3</span>快速开始</a></li><li><a href="1.4-terminal-requirements.html"><span class="chapter-number">1.4</span>终端要求</a></li></ul></div><div class="sidebar-section"><div class="sidebar-title">第二章：基础配置</div><ul class="sidebar-nav"><li><a href="2.1-config-file.html"><span class="chapter-number">2.1</span>配置文件详解</a></li><li><a href="2.2-providers.html"><span class="chapter-number">2.2</span>AI提供商配置</a></li><li><a href="2.3-models.html"><span class="chapter-number">2.3</span>模型选择与配置</a></li><li><a href="2.4-environment.html"><span class="chapter-number">2.4</span>环境变量设置</a></li></ul></div><div class="sidebar-section"><div class="sidebar-title">第三章：界面操作</div><ul class="sidebar-nav"><li><a href="3.1-tui.html"><span class="chapter-number">3.1</span>TUI终端界面</a></li><li><a href="3.2-cli.html"><span class="chapter-number">3.2</span>CLI命令行接口</a></li><li><a href="3.3-web.html"><span class="chapter-number">3.3</span>Web界面</a></li><li><a href="3.4-ide.html"><span class="chapter-number">3.4</span>IDE集成</a></li></ul></div><div class="sidebar-section"><div class="sidebar-title">第四章：核心功能</div><ul class="sidebar-nav"><li><a href="4.1-tools.html"><span class="chapter-number">4.1</span>内置工具详解</a></li><li><a href="4.2-commands.html"><span class="chapter-number">4.2</span>斜杠命令</a></li><li><a href="4.3-keybinds.html"><span class="chapter-number">4.3</span>快捷键参考</a></li><li><a href="4.4-file-reference.html"><span class="chapter-number">4.4</span>文件引用与搜索</a></li></ul></div><div class="sidebar-section"><div class="sidebar-title">第五章：高级配置</div><ul class="sidebar-nav"><li><a href="5.1-agents.html"><span class="chapter-number">5.1</span>Agents代理系统</a></li><li><a href="5.2-rules.html"><span class="chapter-number">5.2</span>Rules规则配置</a></li><li><a href="5.3-themes.html"><span class="chapter-number">5.3</span>主题配置</a></li><li><a href="5.4-permissions.html"><span class="chapter-number">5.4</span>权限系统</a></li></ul></div><div class="sidebar-section"><div class="sidebar-title">第六章：扩展功能</div><ul class="sidebar-nav"><li><a href="6.1-lsp.html"><span class="chapter-number">6.1</span>LSP语言服务器</a></li><li><a href="6.2-formatters.html"><span class="chapter-number">6.2</span>代码格式化器</a></li><li><a href="6.3-custom-commands.html"><span class="chapter-number">6.3</span>自定义命令</a></li><li><a href="6.4-mcp.html"><span class="chapter-number">6.4</span>MCP协议服务器</a></li></ul></div><div class="sidebar-section"><div class="sidebar-title">第七章：开发与集成</div><ul class="sidebar-nav"><li><a href="7.1-sdk.html"><span class="chapter-number">7.1</span>SDK使用指南</a></li><li><a href="7.2-network.html"><span class="chapter-number">7.2</span>网络配置</a></li><li><a href="7.3-enterprise.html"><span class="chapter-number">7.3</span>企业版功能</a></li><li><a href="7.4-troubleshooting.html" class="active"><span class="chapter-number">7.4</span>故障排除</a></li></ul></div></div></aside>
  <main class="main-content">
    <nav class="breadcrumb"><a href="../index.html">首页</a><span class="breadcrumb-separator">/</span><a href="7.1-sdk.html">第七章</a><span class="breadcrumb-separator">/</span><span>故障排除</span></nav>
    <article>
      <header class="article-header"><h1 class="article-title">7.4 故障排除</h1><div class="article-meta"><span class="tag">开发与集成</span><span>第七章：开发与集成</span></div></header>
      <div class="article-content">
        <p>本章涵盖OpenCode使用过程中可能遇到的常见问题及其解决方案。</p>

        <h2>日志位置</h2>
        <p>排查问题的第一步是查看日志文件。</p>

        <h3>日志文件位置</h3>
        <pre><code># macOS
~/Library/Logs/opencode/

# Linux
~/.local/share/opencode/logs/
# 或
~/.config/opencode/logs/

# Windows
%APPDATA%\opencode\logs\</code></pre>

        <h3>查看实时日志</h3>
        <pre><code># 查看最新日志
tail -f ~/.local/share/opencode/logs/opencode.log

# 启用详细日志模式运行
opencode --debug

# 或设置环境变量
export OPENCODE_LOG_LEVEL=debug
opencode</code></pre>

        <h3>日志级别</h3>
        <pre><code># 可用级别：error, warn, info, debug, trace
export OPENCODE_LOG_LEVEL=debug

# 在配置文件中设置
{
  "logging": {
    "level": "debug",
    "file": true,
    "console": true
  }
}</code></pre>

        <h2>常见问题及解决方案</h2>

        <h3>启动问题</h3>

        <h4>问题：OpenCode无法启动</h4>
        <pre><code># 检查是否正确安装
which opencode
opencode --version

# 重新安装
curl -fsSL https://opencode.ai/install | bash

# 检查依赖
# macOS需要Xcode命令行工具
xcode-select --install

# Linux需要基本开发工具
sudo apt install build-essential  # Debian/Ubuntu
sudo dnf groupinstall "Development Tools"  # Fedora</code></pre>

        <h4>问题：终端显示异常</h4>
        <pre><code># 检查终端类型
echo $TERM

# 设置正确的终端类型
export TERM=xterm-256color

# 检查终端是否支持真彩色
printf "\x1b[38;2;255;100;0mTrueColor Test\x1b[0m\n"

# 禁用真彩色（如果不支持）
{
  "tui": {
    "trueColor": false
  }
}</code></pre>

        <h4>问题：配置文件错误</h4>
        <pre><code># 验证配置文件语法
opencode config validate

# 查看当前配置
opencode config show

# 重置为默认配置
mv ~/.config/opencode/opencode.json ~/.config/opencode/opencode.json.bak
opencode</code></pre>

        <h3>认证问题</h3>

        <h4>问题：API密钥无效</h4>
        <pre><code># 检查环境变量是否设置
echo $ANTHROPIC_API_KEY
echo $OPENAI_API_KEY

# 确保没有多余的空格或换行符
export ANTHROPIC_API_KEY="sk-ant-xxx"  # 使用引号

# 测试API密钥
curl https://api.anthropic.com/v1/messages \
  -H "x-api-key: $ANTHROPIC_API_KEY" \
  -H "anthropic-version: 2023-06-01" \
  -H "content-type: application/json" \
  -d '{"model":"claude-3-haiku-20240307","max_tokens":10,"messages":[{"role":"user","content":"Hi"}]}'</code></pre>

        <h4>问题：认证过期</h4>
        <pre><code># 重新登录
opencode auth login

# 清除缓存的认证信息
opencode auth logout
rm -rf ~/.config/opencode/auth/

# 检查认证状态
opencode auth status</code></pre>

        <h4>问题：代理环境下认证失败</h4>
        <pre><code># 确保代理配置正确
export HTTPS_PROXY=http://proxy:8080
export HTTP_PROXY=http://proxy:8080

# 如果代理需要认证
export HTTPS_PROXY=http://user:pass@proxy:8080

# 排除不需要代理的地址
export NO_PROXY=localhost,127.0.0.1</code></pre>

        <h3>模型可用性</h3>

        <h4>问题：模型不可用</h4>
        <pre><code># 检查可用模型列表
opencode model list

# 检查提供商状态
opencode provider status

# 使用备用模型
opencode --model claude-3-haiku-20240307</code></pre>

        <h4>问题：模型响应超时</h4>
        <pre><code># 增加超时时间
{
  "network": {
    "timeout": 120000
  }
}

# 或使用环境变量
export OPENCODE_TIMEOUT=120000

# 使用更快的模型
opencode --model claude-3-haiku-20240307</code></pre>

        <h4>问题：达到速率限制</h4>
        <pre><code># 错误信息：Rate limit exceeded

# 解决方案1：等待后重试
# 大多数提供商的限制每分钟重置

# 解决方案2：配置自动重试
{
  "network": {
    "retries": 5,
    "retryDelay": 2000
  }
}

# 解决方案3：升级API计划或使用多个API密钥</code></pre>

        <h3>提供商错误</h3>

        <h4>问题：API返回错误</h4>
        <pre><code># 常见错误代码
# 400 - 请求格式错误
# 401 - 认证失败
# 403 - 权限不足
# 429 - 速率限制
# 500 - 服务器错误
# 503 - 服务不可用

# 查看详细错误信息
export OPENCODE_LOG_LEVEL=debug
opencode

# 检查API状态页面
# Anthropic: https://status.anthropic.com
# OpenAI: https://status.openai.com</code></pre>

        <h4>问题：Azure OpenAI配置错误</h4>
        <pre><code># 确保所有必需的环境变量都已设置
export AZURE_OPENAI_API_KEY=xxx
export AZURE_OPENAI_ENDPOINT=https://xxx.openai.azure.com
export AZURE_OPENAI_DEPLOYMENT=gpt-4  # 部署名称

# 配置文件方式
{
  "provider": {
    "azure-openai": {
      "apiKey": "${AZURE_OPENAI_API_KEY}",
      "endpoint": "${AZURE_OPENAI_ENDPOINT}",
      "deployment": "gpt-4",
      "apiVersion": "2024-02-15-preview"
    }
  }
}</code></pre>

        <h4>问题：自定义端点连接失败</h4>
        <pre><code># 检查端点是否可访问
curl -v https://your-endpoint.com/v1/health

# 检查SSL证书
openssl s_client -connect your-endpoint.com:443

# 使用自定义CA证书
export NODE_EXTRA_CA_CERTS=/path/to/ca.crt</code></pre>

        <h3>剪贴板问题（Linux）</h3>

        <h4>问题：复制粘贴不工作</h4>
        <pre><code># 检查剪贴板工具
which xclip xsel wl-copy

# 安装剪贴板工具
# X11系统
sudo apt install xclip
# 或
sudo apt install xsel

# Wayland系统
sudo apt install wl-clipboard

# 检查显示服务器类型
echo $XDG_SESSION_TYPE</code></pre>

        <h4>问题：SSH环境下剪贴板不工作</h4>
        <pre><code># SSH时启用X11转发
ssh -X user@server

# 或使用OSC 52剪贴板序列
{
  "tui": {
    "clipboard": "osc52"
  }
}

# 确保终端支持OSC 52
# 支持的终端：iTerm2, Alacritty, kitty等</code></pre>

        <h3>性能问题</h3>

        <h4>问题：响应缓慢</h4>
        <pre><code># 检查网络延迟
ping api.anthropic.com

# 使用更快的模型
opencode --model claude-3-haiku-20240307

# 减少上下文大小
# 避免引用过大的文件

# 启用流式输出
{
  "streaming": true
}</code></pre>

        <h4>问题：内存占用过高</h4>
        <pre><code># 限制会话历史
{
  "session": {
    "maxMessages": 50
  }
}

# 定期压缩会话
# 使用 /compact 命令

# 清理旧会话
opencode session prune --older-than 7d</code></pre>

        <h2>获取帮助</h2>

        <h3>社区资源</h3>
        <ul>
          <li><strong>GitHub Issues</strong> - <a href="https://github.com/anomalyco/opencode/issues" target="_blank">报告Bug和功能请求</a></li>
          <li><strong>GitHub Discussions</strong> - <a href="https://github.com/anomalyco/opencode/discussions" target="_blank">社区讨论</a></li>
          <li><strong>Discord</strong> - <a href="https://discord.gg/opencode" target="_blank">实时交流</a></li>
          <li><strong>官方文档</strong> - <a href="https://opencode.ai/docs" target="_blank">完整文档</a></li>
        </ul>

        <h3>提交Bug报告</h3>
        <p>提交Bug报告时请包含以下信息：</p>
        <pre><code># 收集系统信息
opencode debug info

# 输出示例：
# OpenCode Version: 1.2.3
# OS: macOS 14.0 (Darwin 23.0.0)
# Shell: zsh 5.9
# Terminal: iTerm2 3.5.0
# Node: v20.10.0
# Go: go1.21.5</code></pre>

        <h3>收集调试信息</h3>
        <pre><code># 生成完整的调试包
opencode debug bundle --output debug-bundle.zip

# 包含内容：
# - 系统信息
# - 配置文件（敏感信息已脱敏）
# - 最近的日志
# - 终端能力检测结果</code></pre>

        <div class="tip-box warning">
          <div class="tip-box-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>注意</div>
          <div class="tip-box-content">提交调试包前，请确保其中不包含API密钥、密码等敏感信息。</div>
        </div>

        <h3>企业支持</h3>
        <p>企业版用户可通过以下渠道获取优先支持：</p>
        <ul>
          <li>专属Slack频道</li>
          <li>邮件支持：support@opencode.ai</li>
          <li>电话支持（仅限大型企业客户）</li>
        </ul>

        <h2>自助诊断清单</h2>
        <p>遇到问题时，按以下顺序排查：</p>
        <ol>
          <li>检查OpenCode版本是否最新：<code>opencode --version</code></li>
          <li>验证配置文件语法：<code>opencode config validate</code></li>
          <li>确认API密钥正确设置</li>
          <li>检查网络连接和代理配置</li>
          <li>查看日志文件中的错误信息</li>
          <li>尝试使用默认配置</li>
          <li>搜索GitHub Issues中是否有类似问题</li>
          <li>在社区寻求帮助</li>
        </ol>

        <div class="tip-box info">
          <div class="tip-box-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>完成</div>
          <div class="tip-box-content">恭喜你完成了OpenCode深度教程的学习！现在你已经掌握了从基础到高级的所有OpenCode功能。开始享受AI辅助编程的乐趣吧！</div>
        </div>
      </div>
      <nav class="article-nav">
        <a href="7.3-enterprise.html" class="article-nav-item prev"><div class="article-nav-label">← 上一篇</div><div class="article-nav-title">7.3 企业版功能</div></a>
        <a href="../index.html" class="article-nav-item next"><div class="article-nav-label">返回首页 →</div><div class="article-nav-title">OpenCode深度教程</div></a>
      </nav>
    </article>
  </main>
  <nav class="toc"><div class="toc-title">本页目录</div><ul class="toc-list"></ul></nav>
  <button class="back-to-top" aria-label="回到顶部"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="18 15 12 9 6 15"></polyline></svg></button>
  <script src="../js/main.js"></script>
</body>
</html>
